Homework 6
================
Ainsel Levitskaia-Collins, HL2710
2025-11-22

### Problem 2

#### Bootstrapping

Function for sampling for bootstrapping:

``` r
#' Sample for Bootstrapping
#'
#' @param df Dataframe to sample from
#'
#' @returns A sample selected with replacement for bootstrapping
boot_sample = function(df) {
  sample_frac(df, replace = TRUE)
}
```

Tidying and pulling bootstrap samples from `weather_df`:

``` r
weather_df <- weather_df %>% 
  janitor::clean_names()

weather_bootstrap <- tibble(strap_number = 1:5000) %>% 
  mutate(
    strap_sample = map(strap_number, \(i) boot_sample(df = weather_df))
  )
```

Creating a variable for $\frac{\hat{\beta}_{1}}{\hat{\beta}_{2}}$:

``` r
weather_bs_betas <- weather_bootstrap %>% 
  mutate(
    models = map(strap_sample, \(df) lm(tmax ~ tmin + prcp, data = df)),
    results = map(models, broom::tidy)
  ) %>% 
  select(-strap_sample, -models) %>% 
  unnest(results) %>% 
  select(strap_number, term, estimate) %>% 
  pivot_wider(
    names_from = term,
    values_from = estimate
  ) %>% 
  mutate(beta_ratio = tmin / prcp)

head(weather_bs_betas)
```

    ## # A tibble: 6 × 5
    ##   strap_number `(Intercept)`  tmin     prcp beta_ratio
    ##          <int>         <dbl> <dbl>    <dbl>      <dbl>
    ## 1            1          7.69  1.03 -0.00502      -204.
    ## 2            2          7.68  1.02 -0.00566      -181.
    ## 3            3          7.81  1.02 -0.00734      -139.
    ## 4            4          7.94  1.00 -0.00737      -136.
    ## 5            5          7.63  1.02 -0.00466      -220.
    ## 6            6          7.87  1.01 -0.00593      -170.

Collecting $\hat{r}^{2}$ data:

``` r
weather_bs_rsquared <- weather_bootstrap %>% 
  mutate(
    models = map(strap_sample, \(df) lm(tmax ~ tmin + prcp, data = df)),
    results = map(models, broom::glance)
  ) %>% 
  select(-strap_sample, -models) %>% 
  unnest(results)

head(weather_bs_rsquared)
```

    ## # A tibble: 6 × 13
    ##   strap_number r.squared adj.r.squared sigma statistic p.value    df logLik
    ##          <int>     <dbl>         <dbl> <dbl>     <dbl>   <dbl> <dbl>  <dbl>
    ## 1            1     0.940         0.940  2.71    16915.       0     2 -5233.
    ## 2            2     0.942         0.942  2.67    17585.       0     2 -5224.
    ## 3            3     0.943         0.943  2.67    18096.       0     2 -5218.
    ## 4            4     0.939         0.939  2.76    16572.       0     2 -5280.
    ## 5            5     0.941         0.941  2.71    17472.       0     2 -5253.
    ## 6            6     0.941         0.941  2.73    17280.       0     2 -5270.
    ## # ℹ 5 more variables: AIC <dbl>, BIC <dbl>, deviance <dbl>, df.residual <int>,
    ## #   nobs <int>

Merging the two `weather_bs` datasets, so that all the information is in
one place:

``` r
weather_bs <- merge(weather_bs_betas, weather_bs_rsquared, by = "strap_number") %>% 
  select(strap_number, beta_ratio, r.squared)

head(weather_bs)
```

    ##   strap_number beta_ratio r.squared
    ## 1            1  -204.3571 0.9398773
    ## 2            2  -181.0584 0.9418100
    ## 3            3  -139.0987 0.9434096
    ## 4            4  -136.2841 0.9386314
    ## 5            5  -219.9528 0.9414803
    ## 6            6  -169.9682 0.9408939

#### Plot of the ratio of betas vs r-squared

``` r
plot_weather_estimates <- weather_bs %>% 
  ggplot(aes(x = beta_ratio, y = r.squared)) +
  geom_point() +
  geom_smooth(method = lm, se = FALSE) +
  theme_minimal() +
  xlab("Ratio of beta(minimum temperature) to beta(precipitation)") +
  ylab("R-squared")

plot_weather_estimates
```

![](P8105_HW6_HL2710_files/figure-gfm/unnamed-chunk-7-1.png)<!-- -->

As the ratio between the minimum temperature $\hat{\beta}_{1}$ and
precipitation $\hat{\beta}_{2}$ decreases, the $\hat{r}^{2}$ value tends
to increase.

#### Confidence Interval

``` r
weather_bs_ci <- tibble(
  beta_ratio = quantile(pull(weather_bs, beta_ratio), probs = c(0.025, 0.975)),
  r_squared = quantile(pull(weather_bs, r.squared), probs = c(0.025, 0.975))
)
```

The 95% confidence interval for $\hat{r}^{2}$ is (0.93, 0.95). The 95%
confidence interval for $\frac{\hat{\beta}_{1}}{\hat{\beta}_{2}}$ is
(-281.5, -125.2).

### Problem 3
