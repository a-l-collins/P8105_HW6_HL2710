---
title: "Homework 6"
author: "Ainsel Levitskaia-Collins, HL2710"
date: "2025-11-22"
output: github_document
---

```{r include = FALSE}
library(tidyverse)
library(p8105.datasets)
data("weather_df")
```

### Problem 2

#### Bootstrapping

Function for sampling for bootstrapping:

```{r}
#' Sample for Bootstrapping
#'
#' @param df Dataframe to sample from
#'
#' @returns A sample selected with replacement for bootstrapping
boot_sample = function(df) {
  sample_frac(df, replace = TRUE)
}
```

Tidying and pulling bootstrap samples from `weather_df`:

```{r}
weather_df <- weather_df %>% 
  janitor::clean_names()

weather_bootstrap <- tibble(strap_number = 1:5000) %>% 
  mutate(
    strap_sample = map(strap_number, \(i) boot_sample(df = weather_df))
  )
```

Creating a variable for $\frac{\hat{\beta}_{1}}{\hat{\beta}_{2}}$:

```{r}
weather_bs_betas <- weather_bootstrap %>% 
  mutate(
    models = map(strap_sample, \(df) lm(tmax ~ tmin + prcp, data = df)),
    results = map(models, broom::tidy)
  ) %>% 
  select(-strap_sample, -models) %>% 
  unnest(results) %>% 
  select(strap_number, term, estimate) %>% 
  pivot_wider(
    names_from = term,
    values_from = estimate
  ) %>% 
  mutate(beta_ratio = tmin / prcp)

head(weather_bs_betas)
```

Collecting $\hat{r}^{2}$ data:

```{r}
weather_bs_rsquared <- weather_bootstrap %>% 
  mutate(
    models = map(strap_sample, \(df) lm(tmax ~ tmin + prcp, data = df)),
    results = map(models, broom::glance)
  ) %>% 
  select(-strap_sample, -models) %>% 
  unnest(results)

head(weather_bs_rsquared)
```

Merging the two `weather_bs` datasets, so that all the information is in one place:

```{r}
weather_bs <- merge(weather_bs_betas, weather_bs_rsquared, by = "strap_number") %>% 
  select(strap_number, beta_ratio, r.squared)

head(weather_bs)
```

#### Plot of the ratio of betas vs r-squared

```{r message = FALSE}
plot_weather_estimates <- weather_bs %>% 
  ggplot(aes(x = beta_ratio, y = r.squared)) +
  geom_point() +
  geom_smooth(method = lm, se = FALSE) +
  theme_minimal() +
  xlab("Ratio of beta(minimum temperature) to beta(precipitation)") +
  ylab("R-squared")

plot_weather_estimates
```

As the ratio between the minimum temperature $\hat{\beta}_{1}$ and precipitation $\hat{\beta}_{2}$ decreases, the $\hat{r}^{2}$ value tends to increase.

#### Confidence Interval

```{r}
weather_bs_ci <- tibble(
  beta_ratio = quantile(pull(weather_bs, beta_ratio), probs = c(0.025, 0.975)),
  r_squared = quantile(pull(weather_bs, r.squared), probs = c(0.025, 0.975))
)
```

The 95% confidence interval for $\hat{r}^{2}$ is (`r round(pull(weather_bs_ci, r_squared)[[1]], digits = 2)`, `r round(pull(weather_bs_ci, r_squared)[[2]], digits = 2)`). The 95% confidence interval for $\frac{\hat{\beta}_{1}}{\hat{\beta}_{2}}$ is (`r round(pull(weather_bs_ci, beta_ratio)[[1]], digits = 1)`, `r round(pull(weather_bs_ci, beta_ratio)[[2]], digits = 1)`).



### Problem 3
