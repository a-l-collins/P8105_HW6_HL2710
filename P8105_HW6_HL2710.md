Homework 6
================
Ainsel Levitskaia-Collins, HL2710
2025-11-22

### Problem 2

#### Bootstrapping

Function for sampling for bootstrapping:

``` r
#' Sample for Bootstrapping
#'
#' @param df Dataframe to sample from
#'
#' @returns A sample selected with replacement for bootstrapping
boot_sample = function(df) {
  sample_frac(df, replace = TRUE)
}
```

Tidying and pulling bootstrap samples from `weather_df`:

``` r
weather_df <- weather_df %>% 
  janitor::clean_names()

weather_bootstrap <- tibble(strap_number = 1:5000) %>% 
  mutate(
    strap_sample = map(strap_number, \(i) boot_sample(df = weather_df))
  )
```

Creating a variable for $\frac{\hat{\beta}_{1}}{\hat{\beta}_{2}}$:

``` r
weather_bs_betas <- weather_bootstrap %>% 
  mutate(
    models = map(strap_sample, \(df) lm(tmax ~ tmin + prcp, data = df)),
    results = map(models, broom::tidy)
  ) %>% 
  select(-strap_sample, -models) %>% 
  unnest(results) %>% 
  select(strap_number, term, estimate) %>% 
  pivot_wider(
    names_from = term,
    values_from = estimate
  ) %>% 
  mutate(beta_ratio = tmin / prcp)

head(weather_bs_betas)
```

    ## # A tibble: 6 × 5
    ##   strap_number `(Intercept)`  tmin     prcp beta_ratio
    ##          <int>         <dbl> <dbl>    <dbl>      <dbl>
    ## 1            1          7.75  1.02 -0.00616      -165.
    ## 2            2          7.77  1.02 -0.00717      -142.
    ## 3            3          7.73  1.02 -0.00534      -190.
    ## 4            4          7.72  1.03 -0.00544      -189.
    ## 5            5          7.81  1.02 -0.00560      -182.
    ## 6            6          7.72  1.03 -0.00674      -152.

Collecting $\hat{r}^{2}$ data:

``` r
weather_bs_rsquared <- weather_bootstrap %>% 
  mutate(
    models = map(strap_sample, \(df) lm(tmax ~ tmin + prcp, data = df)),
    results = map(models, broom::glance)
  ) %>% 
  select(-strap_sample, -models) %>% 
  unnest(results)

head(weather_bs_rsquared)
```

    ## # A tibble: 6 × 13
    ##   strap_number r.squared adj.r.squared sigma statistic p.value    df logLik
    ##          <int>     <dbl>         <dbl> <dbl>     <dbl>   <dbl> <dbl>  <dbl>
    ## 1            1     0.942         0.942  2.72    17558.       0     2 -5270.
    ## 2            2     0.943         0.943  2.66    18047.       0     2 -5214.
    ## 3            3     0.939         0.939  2.77    16670.       0     2 -5293.
    ## 4            4     0.941         0.941  2.71    17212.       0     2 -5237.
    ## 5            5     0.939         0.939  2.78    16696.       0     2 -5319.
    ## 6            6     0.943         0.943  2.70    17955.       0     2 -5252.
    ## # ℹ 5 more variables: AIC <dbl>, BIC <dbl>, deviance <dbl>, df.residual <int>,
    ## #   nobs <int>

Merging the two `weather_bs` datasets, so that all the information is in
one place:

``` r
weather_bs <- merge(weather_bs_betas, weather_bs_rsquared, by = "strap_number") %>% 
  select(strap_number, beta_ratio, r.squared)

head(weather_bs)
```

    ##   strap_number beta_ratio r.squared
    ## 1            1  -165.4759 0.9416763
    ## 2            2  -142.1528 0.9432633
    ## 3            3  -190.3293 0.9389418
    ## 4            4  -188.5164 0.9408290
    ## 5            5  -181.7495 0.9388470
    ## 6            6  -152.2310 0.9429154

#### Plot of the ratio of betas vs r-squared

``` r
plot_weather_estimates <- weather_bs %>% 
  ggplot(aes(x = beta_ratio, y = r.squared)) +
  geom_point() +
  geom_smooth(method = lm, se = FALSE) +
  theme_minimal() +
  xlab("Ratio of beta(minimum temperature) to beta(precipitation)") +
  ylab("R-squared")

plot_weather_estimates
```

![](P8105_HW6_HL2710_files/figure-gfm/unnamed-chunk-7-1.png)<!-- -->

As the ratio between the minimum temperature $\hat{\beta}_{1}$ and
precipitation $\hat{\beta}_{2}$ decreases, the $\hat{r}^{2}$ value tends
to increase.

#### Confidence Interval

``` r
weather_bs_ci <- tibble(
  beta_ratio = quantile(pull(weather_bs, beta_ratio), probs = c(0.025, 0.975)),
  r_squared = quantile(pull(weather_bs, r.squared), probs = c(0.025, 0.975))
)
```

The 95% confidence interval for $\hat{r}^{2}$ is (0.93, 0.95). The 95%
confidence interval for $\frac{\hat{\beta}_{1}}{\hat{\beta}_{2}}$ is
(-280.1, -125.2).

### Problem 3

Load and clean `birthweight` dataset, including renaming variables to
something less confusing and lightly reorganizing the variable order:

``` r
birthweight <- read_csv("./data/birthweight.csv") %>% 
  janitor::clean_names() %>% 
  mutate(
    babysex = case_match(babysex,
                         1 ~ "Male",
                         2 ~ "Female"),
    frace = case_match(frace,
                       1 ~ "White",
                       2 ~ "Black",
                       3 ~ "Asian",
                       4 ~ "Puerto Rican",
                       8 ~ "Other",
                       9 ~ "Unknown"),
    mrace = case_match(mrace,
                       1 ~ "White",
                       2 ~ "Black",
                       3 ~ "Asian",
                       4 ~ "Puerto Rican",
                       8 ~ "Other")) %>% 
  rename(
    b_sex = babysex, 
    b_head_cents = bhead, 
    b_length_cents = blength, 
    b_weight_grams = bwt, 
    del_weight_lbs = delwt, 
    fam_income_hunds = fincome, 
    f_race = frace, 
    b_gweeks = gaweeks, 
    b_malform = malform,
    m_menarche_yrs = menarche, 
    m_height_ins = mheight, 
    m_age_yrs = momage, 
    m_race = mrace, 
    num_parity = parity, 
    num_lbw = pnumlbw, 
    num_sga = pnumsga, 
    m_ppbmi = ppbmi, 
    m_ppweight_lbs = ppwt, 
    m_cigs = smoken, 
    m_wtgain_lbs = wtgain) %>% 
  select(b_sex, b_head_cents, b_length_cents, b_weight_grams, b_gweeks, 
         b_malform, del_weight_lbs, fam_income_hunds, f_race, m_menarche_yrs, 
         m_height_ins, m_age_yrs, m_race, m_ppbmi, m_ppweight_lbs, m_cigs, 
         m_wtgain_lbs, num_parity, num_lbw, num_sga)

head(birthweight)
```

    ## # A tibble: 6 × 20
    ##   b_sex  b_head_cents b_length_cents b_weight_grams b_gweeks b_malform
    ##   <chr>         <dbl>          <dbl>          <dbl>    <dbl>     <dbl>
    ## 1 Female           34             51           3629     39.9         0
    ## 2 Male             34             48           3062     25.9         0
    ## 3 Female           36             50           3345     39.9         0
    ## 4 Male             34             52           3062     40           0
    ## 5 Female           34             52           3374     41.6         0
    ## 6 Male             33             52           3374     40.7         0
    ## # ℹ 14 more variables: del_weight_lbs <dbl>, fam_income_hunds <dbl>,
    ## #   f_race <chr>, m_menarche_yrs <dbl>, m_height_ins <dbl>, m_age_yrs <dbl>,
    ## #   m_race <chr>, m_ppbmi <dbl>, m_ppweight_lbs <dbl>, m_cigs <dbl>,
    ## #   m_wtgain_lbs <dbl>, num_parity <dbl>, num_lbw <dbl>, num_sga <dbl>
